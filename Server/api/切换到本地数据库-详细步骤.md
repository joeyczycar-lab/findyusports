# åˆ‡æ¢åˆ°æœ¬åœ°æ•°æ®åº“ - è¯¦ç»†æ­¥éª¤

## ğŸ“‹ å‰ç½®æ£€æŸ¥

### 1. æ£€æŸ¥ PostgreSQL æ˜¯å¦å·²å®‰è£…

```bash
psql --version
```

**å¦‚æœæ˜¾ç¤ºç‰ˆæœ¬å·**ï¼šâœ… å·²å®‰è£…ï¼Œè·³åˆ°æ­¥éª¤ 2  
**å¦‚æœæ˜¾ç¤º "command not found"**ï¼šâŒ éœ€è¦å®‰è£…

---

### 2. å®‰è£… PostgreSQLï¼ˆå¦‚æœæœªå®‰è£…ï¼‰

```bash
# å®‰è£…
brew install postgresql@14

# å¯åŠ¨æœåŠ¡
brew services start postgresql@14

# ç­‰å¾…å‡ ç§’ï¼Œç„¶åæ£€æŸ¥æ˜¯å¦è¿è¡Œ
pg_isready -U postgres
```

**å¦‚æœæ˜¾ç¤º "accepting connections"**ï¼šâœ… æˆåŠŸ  
**å¦‚æœæ˜¾ç¤ºé”™è¯¯**ï¼šç­‰å¾…å‡ ç§’åé‡è¯•

---

## ğŸš€ å¿«é€Ÿåˆ‡æ¢ï¼ˆæ¨èï¼‰

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨è‡ªåŠ¨è„šæœ¬ï¼ˆæœ€ç®€å•ï¼‰

```bash
cd /Users/Zhuanz/Documents/findyusports/Server/api

# è¿è¡Œè®¾ç½®è„šæœ¬
./setup-local-db.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- âœ… æ£€æŸ¥ PostgreSQL æ˜¯å¦å®‰è£…
- âœ… æ£€æŸ¥ PostgreSQL æ˜¯å¦è¿è¡Œ
- âœ… åˆ›å»ºæ•°æ®åº“ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
- âœ… å¤‡ä»½å½“å‰ .env æ–‡ä»¶
- âœ… ç”Ÿæˆæœ¬åœ°æ•°æ®åº“é…ç½®

ç„¶åæŒ‰ç…§è„šæœ¬æç¤ºæ“ä½œå³å¯ï¼

---

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨åˆ‡æ¢ï¼ˆæ›´çµæ´»ï¼‰

#### æ­¥éª¤ 1ï¼šæ£€æŸ¥ PostgreSQL

```bash
# æ£€æŸ¥æ˜¯å¦å®‰è£…
psql --version

# æ£€æŸ¥æ˜¯å¦è¿è¡Œ
pg_isready -U postgres
```

#### æ­¥éª¤ 2ï¼šåˆ›å»ºæ•°æ®åº“ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰

```bash
# åˆ›å»ºæ•°æ®åº“
createdb -U postgres venues

# éªŒè¯åˆ›å»ºæˆåŠŸ
psql -U postgres -l | grep venues
```

#### æ­¥éª¤ 3ï¼šå¤‡ä»½å½“å‰é…ç½®

```bash
cd /Users/Zhuanz/Documents/findyusports/Server/api

# å¤‡ä»½ .env æ–‡ä»¶
cp .env .env.railway.backup
```

#### æ­¥éª¤ 4ï¼šä¿®æ”¹ .env æ–‡ä»¶

ç¼–è¾‘ `Server/api/.env`ï¼Œæ³¨é‡Šæ‰ Railway é…ç½®ï¼Œæ·»åŠ æœ¬åœ°é…ç½®ï¼š

```bash
# åŸæ¥çš„ Railway é…ç½®ï¼ˆæ³¨é‡Šæ‰ï¼‰
# DATABASE_URL=postgresql://postgres:...@yamanote.proxy.rlwy.net:29122/railway
# DB_SSL=true

# æœ¬åœ°æ•°æ®åº“é…ç½®ï¼ˆæ–°å¢ï¼‰
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASS=postgres
DB_NAME=venues

# å…¶ä»–é…ç½®ä¿æŒä¸å˜
PORT=4000
JWT_SECRET=8f2c28d25327d90f3751d54f10fd6d03d8d71192682e19389907b168b8123bfe
```

#### æ­¥éª¤ 5ï¼šè¿è¡Œæ•°æ®åº“è¿ç§»

```bash
cd /Users/Zhuanz/Documents/findyusports/Server/api

# è¿è¡Œæ‰€æœ‰è¿ç§»
npm run migrate:page-view
npm run migrate:add-contact
npm run migrate:add-is-public
npm run migrate:add-district-code
```

#### æ­¥éª¤ 6ï¼šå¯åŠ¨æœåŠ¡

```bash
npm run dev
```

---

## âœ… éªŒè¯æ˜¯å¦æˆåŠŸ

### æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨

```bash
# ç­‰å¾…å‡ ç§’ï¼Œç„¶åæ£€æŸ¥
curl http://localhost:4000/health
```

**å¦‚æœè¿”å› `{"status":"ok"}`**ï¼šâœ… æˆåŠŸï¼

### æ£€æŸ¥æ•°æ®åº“è¿æ¥

```bash
# è¿æ¥æ•°æ®åº“
psql -U postgres -d venues

# æŸ¥çœ‹è¡¨
\dt

# é€€å‡º
\q
```

---

## ğŸ”„ åˆ‡æ¢å› Railway æ•°æ®åº“

å¦‚æœä»¥åæƒ³åˆ‡æ¢å› Railwayï¼š

```bash
cd /Users/Zhuanz/Documents/findyusports/Server/api

# æ¢å¤å¤‡ä»½
cp .env.railway.backup .env

# æˆ–è€…æ‰‹åŠ¨ç¼–è¾‘ .envï¼Œæ¢å¤ Railway é…ç½®
```

---

## â“ å¸¸è§é—®é¢˜

### Q: æç¤º "psql: command not found"
A: PostgreSQL æœªå®‰è£…ï¼Œè¿è¡Œ `brew install postgresql@14`

### Q: æç¤º "could not connect to server"
A: PostgreSQL æœªè¿è¡Œï¼Œè¿è¡Œ `brew services start postgresql@14`

### Q: æç¤º "database already exists"
A: æ•°æ®åº“å·²å­˜åœ¨ï¼Œç›´æ¥ä½¿ç”¨å³å¯ï¼Œè·³è¿‡åˆ›å»ºæ­¥éª¤

### Q: è¿ç§»å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
A: æ£€æŸ¥æ•°æ®åº“æ˜¯å¦åˆ›å»ºæˆåŠŸï¼Œç„¶åé‡è¯•è¿ç§»å‘½ä»¤

### Q: æœåŠ¡å¯åŠ¨åè¿˜æ˜¯è¿æ¥å¤±è´¥ï¼Ÿ
A: æ£€æŸ¥ `.env` æ–‡ä»¶é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿æ²¡æœ‰æ‹¼å†™é”™è¯¯

---

## ğŸ“ å®Œæ•´å‘½ä»¤æ¸…å•

```bash
# 1. æ£€æŸ¥ PostgreSQL
psql --version
pg_isready -U postgres

# 2. å®‰è£…ï¼ˆå¦‚æœéœ€è¦ï¼‰
brew install postgresql@14
brew services start postgresql@14

# 3. åˆ›å»ºæ•°æ®åº“
createdb -U postgres venues

# 4. åˆ‡æ¢åˆ°é¡¹ç›®ç›®å½•
cd /Users/Zhuanz/Documents/findyusports/Server/api

# 5. å¤‡ä»½é…ç½®
cp .env .env.railway.backup

# 6. ä¿®æ”¹ .envï¼ˆä½¿ç”¨ç¼–è¾‘å™¨æˆ–è„šæœ¬ï¼‰
# æ³¨é‡Šæ‰ DATABASE_URL å’Œ DB_SSL
# æ·»åŠ æœ¬åœ°æ•°æ®åº“é…ç½®

# 7. è¿è¡Œè¿ç§»
npm run migrate:page-view
npm run migrate:add-contact
npm run migrate:add-is-public
npm run migrate:add-district-code

# 8. å¯åŠ¨æœåŠ¡
npm run dev

# 9. éªŒè¯
curl http://localhost:4000/health
```

---

## ğŸ¯ æ¨èæµç¨‹

1. **å…ˆè¿è¡Œè‡ªåŠ¨è„šæœ¬**ï¼š`./setup-local-db.sh`
2. **æŒ‰ç…§è„šæœ¬æç¤ºæ“ä½œ**
3. **å¦‚æœè„šæœ¬å¤±è´¥ï¼Œå†æ‰‹åŠ¨æ“ä½œ**

è¿™æ ·æœ€å¿«æœ€çœäº‹ï¼


