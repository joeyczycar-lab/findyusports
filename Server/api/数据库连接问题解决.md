# 数据库连接问题解决

## 问题
看到错误：`Unable to connect to the database. Retrying...` 和 `Error: read ECONNRESET`

## 原因
1. Railway 数据库连接不稳定
2. 网络问题
3. 数据库服务暂时不可用

## 解决方法

### 方法一：等待自动重试（推荐）
TypeORM 会自动重试连接（最多5次，每次间隔3秒）。
**等待一会儿，通常会自动连接成功。**

### 方法二：检查网络连接
```bash
# 测试数据库连接
cd Server/api
npm run view-data
```

如果这个命令能成功，说明数据库连接正常。

### 方法三：重启服务
1. 停止当前服务（Ctrl+C）
2. 重新启动：
   ```bash
   cd Server/api
   npm run dev
   ```

### 方法四：检查环境变量
确保 `.env` 文件中的 `DATABASE_URL` 和 `DB_SSL` 配置正确：
```bash
cd Server/api
cat .env | grep DATABASE
```

### 方法五：使用本地数据库（如果Railway不稳定）
如果 Railway 数据库经常连接失败，可以：
1. 安装本地 PostgreSQL
2. 修改 `.env` 文件，使用本地数据库：
   ```
   DB_HOST=localhost
   DB_PORT=5432
   DB_USER=postgres
   DB_PASS=postgres
   DB_NAME=venues
   DB_SSL=false
   ```

## 常见情况
- **连接成功但很慢**：正常，Railway 免费版可能较慢
- **偶尔连接失败**：正常，等待自动重试即可
- **一直连接失败**：检查网络或数据库服务状态

## 检查服务是否正常
即使看到连接错误，服务可能已经启动成功。检查：
```bash
curl http://localhost:4000/health
```

如果返回 `{"status":"ok"}`，说明服务正常运行，只是数据库连接在重试。


