# 无法连接后端 / 图片上传 fetch failed — 快速排查

按顺序做下面 3 步，多数情况能恢复。

---

## 第 1 步：确认后端能访问

在浏览器新开标签访问（把地址换成你的 Railway 后端地址）：

```
https://findyusports-production.up.railway.app/health
```

- **能打开** 且看到 `{"status":"ok",...}` → 后端在线，继续第 2 步。
- **打不开 / 超时** → 后端未运行或地址错。去 **Railway** → 你的项目 → **findyusports** 服务，看状态是否 Online，Logs 是否有报错，必要时重新部署。

---

## 第 2 步：确认前端用的后端地址

### 若是本地开发（浏览器访问 http://localhost:3000）

在 `Web/webapp` 下建或改 **`.env.local`**，保证有且为**正确**后端地址之一：

- 用**本地后端**：  
  `NEXT_PUBLIC_API_BASE=http://localhost:4000`  
  并确保在 `Server/api` 下已运行 `npm run dev`（端口 4000）。
- 用 **Railway 后端**：  
  `NEXT_PUBLIC_API_BASE=https://findyusports-production.up.railway.app`  
  （不要末尾斜杠）

保存后**重启前端**（停掉 `npm run dev` 再重新运行一次）。

### 若是线上网站（如 findyusports.com 部署在 Vercel）

1. 打开 **Vercel** → 你的前端项目 → **Settings** → **Environment Variables**。
2. 找到 **`NEXT_PUBLIC_API_BASE`**：
   - 值应为 Railway 后端**根地址**，例如：`https://findyusports-production.up.railway.app`（无末尾 `/`）。
   - 没有就**新建**，名字 `NEXT_PUBLIC_API_BASE`，值填上面地址。
3. 保存后到 **Deployments** 里**重新部署**一次（Redeploy），否则不生效。

---

## 第 3 步：再试一次

- 本地：刷新 http://localhost:3000 再试登录或上传。
- 线上：刷新网站再试。

若仍报「无法连接」或「图片处理上传失败: fetch failed」：

- **本地**：看终端里 Next 和（若用本地后端）后端是否有报错。
- **线上**：看 **Vercel** 该项目的 **Logs** 里，请求 `/api/venues/.../upload` 或 `/api/auth/login` 是否有 502/超时；同时看 **Railway** 后端 **Logs** 是否收到请求。

---

## 小结

| 你当前在…           | 要检查的… |
|--------------------|-----------|
| 本地打开 localhost:3000 | `.env.local` 里 `NEXT_PUBLIC_API_BASE` 是 `http://localhost:4000` 还是 Railway 地址；本地后端是否已启动（若用 localhost:4000） |
| 线上 findyusports.com   | Vercel 的 `NEXT_PUBLIC_API_BASE` 是否等于 Railway 后端地址；改完后是否重新部署了前端 |
| 无论哪种                 | 浏览器直接打开 `后端地址/health` 能否看到 `{"status":"ok"}` |

按上面做完仍不行时，把「第 1 步 /health 能否打开」和「当前是本地还是线上」发一下，便于继续排查。
