# 图片上传问题诊断指南

## 常见问题及解决方法

### 问题 1：提示"请先登录"

**原因：** 用户未登录或登录状态已过期

**解决方法：**
1. 点击"请先登录"按钮
2. 使用账号登录
3. 登录成功后重试上传

### 问题 2：提示"OSS未配置"或"图片上传功能需要配置阿里云 OSS"

**原因：** Railway 后端未配置 OSS 环境变量

**解决方法：**
1. 登录 Railway 控制台：https://railway.app
2. 选择你的后端项目
3. 进入 **Settings** → **Variables**
4. 添加以下环境变量：
   - `OSS_ACCESS_KEY_ID` - 阿里云 AccessKey ID
   - `OSS_ACCESS_KEY_SECRET` - 阿里云 AccessKey Secret
   - `OSS_REGION` - OSS 地域（如：oss-cn-hangzhou）
   - `OSS_BUCKET` - OSS Bucket 名称
5. 保存后，Railway 会自动重新部署
6. 等待部署完成后重试上传

**详细配置说明：** 查看 `Server/api/RAILWAY_OSS_SETUP.md`

### 问题 3：上传失败，提示网络错误

**原因：** 后端服务未运行或无法连接

**解决方法：**
1. 检查后端服务是否在运行
2. 如果使用 Railway，检查部署状态
3. 检查网络连接
4. 查看浏览器控制台（F12）的错误信息

### 问题 4：上传超时

**原因：** 图片太大或网络较慢

**解决方法：**
1. 确保图片大小不超过 10MB
2. 尝试压缩图片后再上传
3. 检查网络连接速度

### 问题 5：上传成功但图片不显示

**原因：** OSS Bucket 权限设置不正确

**解决方法：**
1. 登录阿里云 OSS 控制台
2. 找到你的 Bucket
3. 进入 **权限管理** → **读写权限**
4. 设置为 **公共读**

## 检查步骤

### 步骤 1：检查登录状态

打开浏览器控制台（F12），查看是否有认证相关的错误。

### 步骤 2：检查后端服务

访问后端健康检查接口：
- 本地：http://localhost:4000/health
- Railway：你的 Railway 后端地址/health

### 步骤 3：检查 OSS 配置

如果使用 Railway，检查环境变量是否已配置：
1. 登录 Railway
2. 查看后端服务的环境变量
3. 确认所有 OSS 相关变量都已设置

### 步骤 4：查看错误日志

1. 打开浏览器控制台（F12）
2. 切换到 **Network** 标签页
3. 尝试上传图片
4. 查看上传请求的响应，查看错误信息

## 测试上传

如果所有配置都正确，上传流程应该是：
1. 选择图片文件
2. 点击"添加图片"按钮
3. 看到"上传中..."提示
4. 上传成功后，图片自动显示在图片列表中

如果上传失败，请查看浏览器控制台的错误信息，并根据错误信息参考上述解决方法。
