# 图片显示问题排查指南

## 🔍 问题现象
上传的图片无法显示

## 🛠️ 排查步骤

### 1. 检查图片是否上传成功

#### 方法一：查看浏览器控制台
1. 打开浏览器开发者工具（F12）
2. 切换到 "Network" 标签
3. 上传图片
4. 查看是否有上传请求，状态码是否为 200

#### 方法二：检查后端日志
查看后端服务日志，应该看到：
```
✅ Processed image saved: id=xxx, venueId=xxx, url=https://...
```

### 2. 检查图片 URL

#### 查看图片 URL 格式
图片 URL 应该是这样的格式：
```
https://venues-images.oss-cn-hangzhou.aliyuncs.com/venues/xxx.jpg
```

#### 检查 URL 是否完整
- URL 应该以 `https://` 开头
- 应该包含 `aliyuncs.com` 域名
- 路径应该是 `venues/xxx.jpg` 格式

### 3. 检查 OSS 配置

#### 检查环境变量
确保后端 `.env` 文件中配置了：
```env
OSS_ACCESS_KEY_ID=your_key
OSS_ACCESS_KEY_SECRET=your_secret
OSS_REGION=oss-cn-hangzhou
OSS_BUCKET=venues-images
```

#### 检查 OSS Bucket 权限
1. 登录阿里云 OSS 控制台
2. 找到 `venues-images` bucket
3. 检查 "读写权限" 是否设置为 "公共读"
4. 检查 "跨域设置" 是否允许你的域名访问

### 4. 检查图片是否真的存在

#### 方法一：直接访问图片 URL
在浏览器中直接打开图片 URL，看是否能显示

#### 方法二：使用 curl 测试
```bash
curl -I https://venues-images.oss-cn-hangzhou.aliyuncs.com/venues/xxx.jpg
```
应该返回 `200 OK`

### 5. 检查前端代码

#### 检查图片组件
打开浏览器控制台，查看是否有错误：
- `Failed to load image`
- `CORS error`
- `403 Forbidden`

#### 检查图片 URL 是否正确传递
在浏览器控制台输入：
```javascript
// 查看图片数据
fetch('/api/venues/1/images').then(r => r.json()).then(console.log)
```

### 6. 常见问题及解决方案

#### 问题 1：图片 URL 为空或 undefined
**原因**：图片上传失败或数据库保存失败
**解决**：
1. 检查后端日志
2. 检查 OSS 配置
3. 重新上传图片

#### 问题 2：图片显示 "加载中..." 但一直不显示
**原因**：图片 URL 无效或网络问题
**解决**：
1. 检查图片 URL 是否可访问
2. 检查网络连接
3. 检查 OSS 跨域设置

#### 问题 3：显示 "图片加载失败"
**原因**：图片不存在或权限问题
**解决**：
1. 检查 OSS Bucket 权限
2. 检查图片是否真的上传成功
3. 检查 URL 是否正确

#### 问题 4：CORS 错误
**原因**：OSS 跨域设置不正确
**解决**：
1. 在 OSS 控制台设置跨域规则
2. 允许你的域名访问

### 7. 快速修复方法

#### 如果图片 URL 有问题
检查 `Server/api/src/modules/venues/venues.service.ts` 中的图片 URL 生成逻辑

#### 如果 OSS 配置有问题
1. 检查 `.env` 文件
2. 重启后端服务
3. 重新上传图片

#### 如果前端显示有问题
1. 清除浏览器缓存
2. 检查 `ResponsiveImage` 组件
3. 查看浏览器控制台错误

## 🔧 调试命令

### 检查图片 API
```bash
# 获取场地图片列表
curl http://localhost:4000/api/venues/1/images

# 应该返回 JSON，包含图片 URL
```

### 检查图片 URL
```bash
# 测试图片 URL 是否可访问
curl -I "https://venues-images.oss-cn-hangzhou.aliyuncs.com/venues/xxx.jpg"
```

## 📝 需要提供的信息

如果问题仍然存在，请提供：
1. 浏览器控制台的错误信息
2. 后端服务的日志
3. 图片 URL（可以隐藏敏感部分）
4. 上传图片时的网络请求详情

